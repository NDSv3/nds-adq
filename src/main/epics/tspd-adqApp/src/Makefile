#+======================================================================
# $HeadURL: https://svnpub.iter.org/codac/iter/codac/dev/units/m-epics-iter-templates/tags/CODAC-CORE-6.0.0/templates/genericApp/src/Makefile $
# $Id: Makefile 83098 2018-01-08 13:23:38Z cesnikt $
#
# Project       : CODAC Core System
#
# Description   : Makefile
#
# Author(s)     : This file was generated by CODAC development toolkit
#
# Copyright (c) : 2010-2018 ITER Organization,
#                 CS 90 046
#                 13067 St. Paul-lez-Durance Cedex
#                 France
#
# This file is part of ITER CODAC software.
# For the terms and conditions of redistribution or use of this software
# refer to the file ITER-LICENSE.TXT located in the top level directory
# of the distribution package.
#
#-======================================================================
TOP=../..

include $(TOP)/configure/CONFIG
#----------------------------------------
#  ADD MACRO DEFINITIONS AFTER THIS LINE

#=============================
# Build the IOC support library
CXX = g++

# We enable the c++11 flag, plus we define the NDS3_DLL preprocessor macro.
CXXFLAGS = -std=c++11 -Wall -Wextra -pedantic -fPIC -pthread -DNDS3_DLL -DLINUX

# Flags passed to gcc during linking
LINK = -shared -fPIC -Wl,-as-needed

# Name of the device library
TARGET = ../../lib/libtspd-adq.so

LIBRARY_IOC += tspd-adq

# Dependency on NDS3 and ADQAPI
LIBS = -lnds3 -ladq -lrt

# tspd-adq.dbd will be created and installed
###DBD += tspd-adq.dbd

# tspd-adq_registerRecordDeviceDriver.cpp derives from tspd-adq.dbd
tspd-adq_SRCS += ADQAIChannel.cpp  ADQAIChannelGroup.cpp  ADQDevice.cpp
#tspd-adq_INCLUDES += -I/opt/e ADQAIChannel.h  ADQAIChannelGroup.h  ADQDevice.h
#OP_SYS_CFLAGS += -std=c++11

OBJS = $(tspd-adq_SRCS:.cpp=.o)

# Rules for building
$(TARGET): $(OBJS)
	$(CXX) $(LINK) -o $@ $^ $(LIBS)
 
.PHONY: clean
clean:
	$(RM) $(TARGET) $(OBJS)

# Build the main IOC entry point on workstation OSs.
#tspd-adq_SRCS_DEFAULT += tspd-adqMain.cpp
#tspd-adq_SRCS_vxWorks += -nil-

#=============================
# Include makefile snippets to add support for additional modules

-include $(EPICS_ROOT)/mk/codac-common.mk

tspd-adq_DBD  += $(CODAC_DBD)
tspd-adq_LIBS += $(CODAC_LIBS)

#=============================
# Include SNL program makefile snippets

###-include ../*.snlprog

#=============================
# Finally link to the EPICS Base libraries

tspd-adq_LIBS += $(EPICS_BASE_IOC_LIBS)

#=============================

include $(TOP)/configure/RULES
#----------------------------------------
#  ADD RULES AFTER THIS LINE

